# ××¢×¨×›×ª Cache - ×ª×™×¢×•×“

## ×¡×§×™×¨×” ×›×œ×œ×™×ª

××¢×¨×›×ª cache ××§×•××™×ª ×©× ×‘× ×ª×” ×›×“×™ ×œ×”××™×¥ ××ª ×”××¢×¨×›×ª ×•×œ×”×¤×—×™×ª ×¢×•××¡ ×¢×œ Supabase ×•-iCount API.

×”××¢×¨×›×ª ×©×•××¨×ª ××ª ×”-100 ×¤×¢×•×œ×•×ª ×”××—×¨×•× ×•×ª ×‘×–×™×›×¨×•×Ÿ ×¢× TTL (Time To Live) ×“×™× ××™ ×œ×¤×™ ×¡×•×’ ×”× ×ª×•× ×™×.

## ××¨×›×™×˜×§×˜×•×¨×”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚
â”‚   (page.js)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cache API      â”‚
â”‚  (/api/cache/*) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ cachedSupabase  â”‚â”€â”€â”€â”€â†’â”‚ localCache   â”‚
â”‚   (wrapper)     â”‚     â”‚   (LRU)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase DB   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ×§×‘×¦×™× ×©× ×•×¦×¨×•

### 1. Core Cache Layer

#### `src/lib/cache/localCache.js`
- **×ª×™××•×¨**: ××™××•×© LRU (Least Recently Used) cache ×¢× TTL
- **×ª×›×•× ×•×ª**:
  - ××§×¡×™××•× 100 ×¤×¨×™×˜×™×
  - TTL ×‘×¨×™×¨×ª ××—×“×œ: 5 ×“×§×•×ª
  - × ×™×§×•×™ ××•×˜×•××˜×™ ×›×œ ×“×§×”
  - ××—×™×§×ª ×”×¤×¨×™×˜×™× ×”×™×©× ×™× ×‘×™×•×ª×¨ ×›×©×”-cache ××œ×

**Methods**:
```javascript
localCache.set(key, value, ttl)      // ×©××™×¨×ª ×¢×¨×š
localCache.get(key)                   // ×§×‘×œ×ª ×¢×¨×š (××• null ×× ×¤×’ ×ª×•×§×£)
localCache.delete(key)                // ××—×™×§×ª ×¢×¨×š
localCache.clear()                    // × ×™×§×•×™ ×›×œ ×”-cache
localCache.getStats()                 // ×¡×˜×˜×™×¡×˜×™×§×•×ª
```

#### `src/lib/cache/cachedSupabase.js`
- **×ª×™××•×¨**: Wrapper ×œ-Supabase ×¢× cache ××•×˜×•××˜×™
- **×ª×›×•× ×•×ª**:
  - ×©××™×œ×ª×•×ª ××•×›× ×•×ª ×¢× cache
  - TTL ×©×•× ×” ×œ×›×œ ×¡×•×’ × ×ª×•× ×™×
  - ×¤×•× ×§×¦×™×™×ª invalidation ×œ×¤×™ pattern

**Functions**:
```javascript
cachedSupabase.getRecentOrders(limit)    // ×”×–×× ×•×ª ××—×¨×•× ×•×ª (2 ×“×§×•×ª)
cachedSupabase.getActiveOrders()         // ×”×–×× ×•×ª ×¤×¢×™×œ×•×ª (1 ×“×§×”)
cachedSupabase.getCustomers(limit)       // ×œ×§×•×—×•×ª (10 ×“×§×•×ª)
cachedSupabase.getMonthlyRevenue()       // ×”×›× ×¡×•×ª ×—×•×“×©×™×•×ª (5 ×“×§×•×ª)
cachedSupabase.getRecentInvoices(limit)  // ×—×©×‘×•× ×™×•×ª ××—×¨×•× ×•×ª (3 ×“×§×•×ª)
cachedSupabase.getStats()                // ×¡×˜×˜×™×¡×˜×™×§×•×ª ×›×œ×œ×™×•×ª (1 ×“×§×”)
cachedSupabase.getOrder(id)              // ×”×–×× ×” ×‘×•×“×“×ª (×œ×œ× cache)
cachedSupabase.invalidateCache(pattern)  // ××—×™×§×ª cache ×œ×¤×™ pattern
cachedSupabase.clearCache()              // × ×™×§×•×™ ×›×œ ×”-cache
```

### 2. API Routes

#### `src/app/api/cache/stats/route.js`
- **GET**: ××—×–×™×¨ ×¡×˜×˜×™×¡×˜×™×§×•×ª (activeOrders, totalCustomers, monthlyRevenue)
- **DELETE**: ×× ×§×” ××ª cache ×”×¡×˜×˜×™×¡×˜×™×§×•×ª

#### `src/app/api/cache/orders/route.js`
- **GET**: ××—×–×™×¨ ×”×–×× ×•×ª
  - Query params: `limit` (default: 100), `type` (recent/active)
- **DELETE**: ×× ×§×” ××ª cache ×”×”×–×× ×•×ª

#### `src/app/api/cache/info/route.js`
- **GET**: ××™×“×¢ ×¢×œ ××¦×‘ ×”-cache
  - Returns: totalItems, maxSize, utilization, recommendations
- **DELETE**: ×× ×§×” ××ª ×›×œ ×”-cache

### 3. Frontend Integration

#### `src/app/page.js` (Updated)
- **×©×™× ×•×™×™×**:
  - ×”×•×—×œ×£ Supabase ×™×©×™×¨ ×‘×§×¨×™××•×ª API cached
  - ×”×•×¡×£ ××™× ×“×™×§×˜×•×¨ "Cache" ×‘×–××Ÿ ×˜×¢×™× ×” ×cache
  - × ×™×§×•×™ cache ××•×˜×•××˜×™ ××—×¨×™ ×¡× ×›×¨×•×Ÿ ×¢× iCount
  - ×”×¡×¨×ª import ××™×•×ª×¨ ×©×œ supabase

#### `src/app/cache/page.js` (New)
- **×ª×™××•×¨**: ×¢××•×“ × ×™×”×•×œ cache
- **×ª×›×•× ×•×ª**:
  - ×ª×¦×•×’×ª ×¡×˜×˜×™×¡×˜×™×§×•×ª cache (×¤×¨×™×˜×™×, × ×™×¦×•×œ, ×¡×˜×˜×•×¡)
  - ×¨×©×™××ª ×›×œ ×”×¤×¨×™×˜×™× ×‘-cache
  - ×›×¤×ª×•×¨ ×œ× ×™×§×•×™ cache
  - ×¢×“×›×•×Ÿ ××•×˜×•××˜×™ ×›×œ 5 ×©× ×™×•×ª

#### `src/components/Layout.jsx` (Updated)
- ×”×•×¡×£ ×§×™×©×•×¨ ×œ×¢××•×“ Cache ×‘×ª×¤×¨×™×˜ ×”× ×™×•×•×˜ (ğŸ’¾)

## TTL (Time To Live) ×œ×¤×™ ×¡×•×’ × ×ª×•× ×™×

| ×¡×•×’ × ×ª×•× ×™× | TTL | ×¡×™×‘×” |
|-----------|-----|------|
| ×¡×˜×˜×™×¡×˜×™×§×•×ª ×›×œ×œ×™×•×ª | 1 ×“×§×” | ××©×ª× ×” ×ª×›×•×¤×•×ª, ×¦×¨×™×š ×œ×”×™×•×ª ×¢×“×›× ×™ |
| ×”×–×× ×•×ª ××—×¨×•× ×•×ª | 2 ×“×§×•×ª | ××©×ª× ×” ×‘×™× ×•× ×™ |
| ×—×©×‘×•× ×™×•×ª ××—×¨×•× ×•×ª | 3 ×“×§×•×ª | ××©×ª× ×” ×¤×—×•×ª ×ª×›×•×¤×•×ª |
| ×”×›× ×¡×•×ª ×—×•×“×©×™×•×ª | 5 ×“×§×•×ª | ××©×ª× ×” ××˜ |
| ×œ×§×•×—×•×ª | 10 ×“×§×•×ª | ××©×ª× ×” ×œ×¢×™×ª×™× ×¨×—×•×§×•×ª |

## ×ª×•×¢×œ×•×ª ×”××¢×¨×›×ª

### 1. ×‘×™×¦×•×¢×™×
- **×˜×¢×™× ×” ××”×™×¨×” ×™×•×ª×¨**: × ×ª×•× ×™× × ×˜×¢× ×™× ××–×™×›×¨×•×Ÿ ×‘××§×•× ×-DB
- **×¤×—×•×ª ×¢×•××¡ ×¢×œ DB**: ×”×¤×—×ª×ª ××¡×¤×¨ ×”×©××™×œ×ª×•×ª ×œ-Supabase
- **×—×•×•×™×ª ××©×ª××© ×˜×•×‘×” ×™×•×ª×¨**: ××™× ×“×™×§×˜×•×¨ cache ×‘×¨×•×¨

### 2. ×”×’× ×” ×¢×œ API
- **×× ×™×¢×ª rate limiting**: ×¤×—×•×ª ×§×¨×™××•×ª ×œ-iCount API
- **×©××™×¨×” ×¢×œ ×”××›×¡×”**: ×—×¡×›×•×Ÿ ×‘×§×¨×™××•×ª API

### 3. × ×™×”×•×œ
- **×¢××•×“ × ×™×”×•×œ ×™×™×¢×•×“×™**: ××¢×§×‘ ××—×¨ ××¦×‘ ×”-cache
- **× ×™×§×•×™ ×§×œ**: ×›×¤×ª×•×¨ ××—×“ ×œ× ×™×§×•×™
- **×©×§×™×¤×•×ª**: ×¨×•××™× ××” × ××¦× ×‘-cache ×•××ª×™ ×™×¤×•×’

## ×©×™××•×© ×œ×“×•×’××”

### ×‘×§×•×“:
```javascript
// ×™×©×Ÿ - ×™×©×™×¨ ×Supabase
const { data } = await supabase.from('orders').select('*')

// ×—×“×© - ×“×¨×š cache
const response = await fetch('/api/cache/orders?limit=100')
const { data, fromCache } = await response.json()

// ××• ×™×©×™×¨×•×ª ××”wrapper:
import { cachedSupabase } from '@/lib/cache/cachedSupabase'
const { data, fromCache } = await cachedSupabase.getRecentOrders(100)
```

### × ×™×§×•×™ cache ××—×¨×™ ×¢×“×›×•×Ÿ:
```javascript
// ××—×§ cache ×¡×¤×¦×™×¤×™
await fetch('/api/cache/orders', { method: 'DELETE' })

// ××• ×“×¨×š wrapper:
cachedSupabase.invalidateCache('orders')

// ××—×§ ×”×›×œ
await fetch('/api/cache/info', { method: 'DELETE' })
```

## Recommendations

### ×›××©×¨ ×œ× ×§×•×ª cache:
1. **××—×¨×™ ×¡× ×›×¨×•×Ÿ ×¢× iCount** - âœ… ×›×‘×¨ ××™×•×©×
2. **××—×¨×™ ×™×¦×™×¨×ª ×”×–×× ×” ×—×“×©×”** - ×¦×¨×™×š ×œ×”×•×¡×™×£
3. **××—×¨×™ ×¢×“×›×•×Ÿ ×”×–×× ×”** - ×¦×¨×™×š ×œ×”×•×¡×™×£
4. **××—×¨×™ ××—×™×§×ª ×”×–×× ×”** - ×¦×¨×™×š ×œ×”×•×¡×™×£

### ×©×™×¤×•×¨×™× ×¢×ª×™×“×™×™×:
1. **Redis** - ×‘××§×•× cache ×‘×–×™×›×¨×•×Ÿ, ×œ×”×©×ª××© ×‘-Redis ×œ×©×™×ª×•×£ cache ×‘×™×Ÿ instances
2. **Stale-While-Revalidate** - ×œ×”×—×–×™×¨ × ×ª×•× ×™× ×™×©× ×™× ×ª×•×š ×›×“×™ ×¨×¢× ×•×Ÿ ×‘×¨×§×¢
3. **Cache warming** - ×œ×˜×¢×•×Ÿ × ×ª×•× ×™× ×¤×•×¤×•×œ×¨×™×™× ××¨××©
4. **Metrics** - ××¢×§×‘ ××—×¨ hit/miss ratio

## ××¡×§× ×”

××¢×¨×›×ª cache ×¤×©×•×˜×” ××š ×™×¢×™×œ×” ×©××©×¤×¨×ª ××©××¢×•×ª×™×ª ××ª ×‘×™×¦×•×¢×™ ×”××¢×¨×›×ª ×ª×•×š ×”×’× ×” ×¢×œ ×”-API rate limits.

×”××¢×¨×›×ª ××•×›× ×” ×œ×©×™××•×© ×•×¢×•×‘×“×ª ×”×—×œ ××¢×›×©×™×•!

---
× ×•×¦×¨: 2026-01-14
